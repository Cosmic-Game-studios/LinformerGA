// -- 3) Inhalt sicher einlesen -----------------------------------------------

// a) Dateinamen absolut sauber machen
$currentFile = trim(basename($currentFile));      // entfernt \ / CR/LF/Spaces

// b) Vollständigen Pfad zusammensetzen (OS-unabhängig)
$path = rtrim($this->logDir, '\\/') . DIRECTORY_SEPARATOR . $currentFile;

// c) Existenz- UND Dateityp-Check  ➜ ansonsten 404
abort_unless(File::isFile($path), 404);

// d) Jetzt gefahrlos lesen und in umgekehrter Reihenfolge anzeigen
$lines = collect(preg_split('/\r?\n/', File::get($path)))
    ->filter()        // leere Zeilen weg
    ->reverse()       // neueste zuerst
    ->values()
    ->map(function (string $line) {
        preg_match('/\.(?<lvl>[A-Z]+):/', $line, $m);
        return [
            'raw'   => $line,
            'level' => strtolower($m['lvl'] ?? 'info'),
        ];
    });